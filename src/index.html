<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞–Ω—Ü–∏—è</title>
    <link rel="shortcut icon" href="data:image/png;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbbv+DGW3/mRlt/5kZbf+ZGq6/hIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGa3/ohkt/7/Zbj//2S3/v9lt/6WAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGm5/iRlt/74Zbj//2W4//9luP//Zbf++mi4/i4gIPciGhr24hsb9uwbG/bsGhr24CEh9xoAAAAAAAAAAAAAAABnuP5mZLf+/2W4//9luP//Zbj//2S3/v9muP5yGBj2rhMT9v8TE/b/ExP2/xMT9f8YGPWkAAAAAAAAAAAAAAAAb7z/BGW3/tZluP//Zbj//2W4//9lt/7gJzH3ShMT9f8TE/b/ExP2/xMT9v8TE/b/ExP1/CAg9joAAAAAAAAAAAAAAABmuP5GZLf+6GS3/uhkt/7oZbf+UhgY9YQSEvX/ExP2/xMT9v8TE/b/ExP2/xIS9f8aGvZ8AAAAAD4++gQgIPZ6IiL2hiIi9oYgIPZ8KCj5BAAAAAAtLfgUFBT17BMT9v8TE/b/ExP2/xMT9v8VFfXoLCz4DgAAAAAaGvZqEhL1/xMT9v8TE/b/EhL1/xsb9nIAAAAAAAAAABwc9m4SEvX/ExP2/xMT9v8SEvX/HR32ZAAAAAAnJ/gSFRX16hMT9v8TE/b/ExP2/xMT9v8UFPXuJyf4Fp2xlAKNnqUYLC/mfhYW83ATE/VuFxf1aDc3+gIAAAAAGBj1fhIS9f8TE/b/ExP2/xMT9v8TE/b/ExP1/xkZ9YaGn3yIhZ57/4Wee/+Gn3yKAAAAAAAAAAAAAAAAAAAAACMj9zYTE/X8ExP2/xMT9v8TE/b/ExP2/xMT9f9JUshihZ57+IaffP+Gn3z/hZ579oigfiYAAAAAAAAAAAAAAAAAAAAAGBj1oBIS9f8TE/b/ExP2/xMT1f8YGPWmiKB+PIWee/+Gn3z/hp98/4Wee/+HoH06AAAAAAAAAAAAAAAAAAAAACUl9xgVFfXOExP11BMT9dQUFPXQJib3HgAAAACGn3ymhp98/4affP+Gn3ymAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAiKB+EIihf0CIoX9AiKB+EAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AADg/wAA4MMAAOCBAADggQAA8QEAAOeBAADDwwAAgf8AAIAPAACBDwAAgQ8AAMMPAAD//wAA//8AAA==" type="image/png">
    <link href="./index.css" rel="stylesheet"/>
</head>
<body>
<button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
    <span id="themeIcon">üåô</span>
</button>

<h1>–°—Ç–∞–Ω—Ü–∏—è</h1>

<div class="components-container">
    <div class="component-wrapper">
        <libp2p-node
            id="libp2p-node-1"
            title="–°—Ç–∞–Ω—Ü–∏—è"
            data-auto-start="false"
        >
        </libp2p-node>
    </div>
    <div class="dashboard">
        <node-identity
                id="node-identity-1"
                title="–°—Ç–∞–Ω—Ü–∏—è"
                data-auto-refresh="true"
                data-refresh-interval="30000"
                data-show-details="true">
        </node-identity>
        <network-addresses id="network-addresses-1"
                           title="Network Addresses"
                           data-auto-refresh="false"
                           data-refresh-interval="30000"
                           data-source="auto"
                           data-show-stats="true">
        </network-addresses>
        <bootstrap-address id="bootstrap-address-1"
                           title="Bootstrap Addresses"
                           data-auto-refresh="true"
                           data-refresh-interval="20000"
                           data-source="auto"
                           data-default-source="all">
        </bootstrap-address>
    </div>
    <div class="component-wrapper">
        <dht-manager id="dht-manager-1"
                     title="DHT Manager"
                     data-auto-refresh="false"
                     data-default-type="all">
        </dht-manager>
    </div>
    <div class="component-wrapper">
        <peers-manager id="peers-manager-1"
                       title="Peers Manager"
                       data-auto-refresh="true"
                       data-refresh-interval="15000">
        </peers-manager>
    </div>
</div>
<script type="module" src="./index.js"></script>
<script>
    function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);

        const themeIcon = document.getElementById('themeIcon');
        themeIcon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }

    // Load saved theme
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        const themeIcon = document.getElementById('themeIcon');
        themeIcon.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    });

    // Export functions for testing
    window.toggleTheme = toggleTheme;

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
    window.getLibp2pNode = () => document.querySelector('libp2p-node#libp2p-node-1');
    window.getDHTManager = () => document.querySelector('dht-manager#dht-manager-1');

    // Global functions for external control
    window.refreshDHTStats = async () => {
        const dhtManager = document.querySelector('dht-manager#dht-manager-1');
        if (dhtManager) {
            return await dhtManager.postMessage({ type: 'REFRESH_STATS' });
        }
        return { success: false, error: 'DHT Manager not found' };
    };

    window.getDHTStats = async () => {
        const dhtManager = document.querySelector('dht-manager#dht-manager-1');
        if (dhtManager) {
            return await dhtManager.postMessage({ type: 'GET_STATS' });
        }
        return { success: false, error: 'DHT Manager not found' };
    };

    window.switchDHTType = async (type) => {
        const dhtManager = document.querySelector('dht-manager#dht-manager-1');
        if (dhtManager) {
            return await dhtManager.postMessage({
                type: 'SWITCH_TYPE',
                data: { type }
            });
        }
        return { success: false, error: 'DHT Manager not found' };
    };

    window.findPeer = async (peerId, dhtType = 'all') => {
        const dhtManager = document.querySelector('dht-manager#dht-manager-1');
        if (dhtManager) {
            return await dhtManager.postMessage({
                type: 'FIND_PEER',
                data: { peerId, dhtType }
            });
        }
        return { success: false, error: 'DHT Manager not found' };
    };

    window.findProviders = async (cid, dhtType = 'all', maxProviders = 20) => {
        const dhtManager = document.querySelector('dht-manager#dht-manager-1');
        if (dhtManager) {
            return await dhtManager.postMessage({
                type: 'FIND_PROVIDERS',
                data: { cid, dhtType, maxProviders }
            });
        }
        return { success: false, error: 'DHT Manager not found' };
    };

    window.provideContent = async (cid, dhtType = 'all') => {
        const dhtManager = document.querySelector('dht-manager#dht-manager-1');
        if (dhtManager) {
            return await dhtManager.postMessage({
                type: 'PROVIDE_CONTENT',
                data: { cid, dhtType }
            });
        }
        return { success: false, error: 'DHT Manager not found' };
    };

    window.getDHTBuckets = async (dhtType = 'lan') => {
        const dhtManager = document.querySelector('dht-manager#dht-manager-1');
        if (dhtManager) {
            return await dhtManager.postMessage({
                type: 'GET_BUCKETS',
                data: { type: dhtType }
            });
        }
        return { success: false, error: 'DHT Manager not found' };
    };

    // Event dispatchers for external control
    window.dispatchDHTEvent = (eventType, data = {}) => {
        const event = new CustomEvent(`dht:${eventType}`, { detail: data });
        window.dispatchEvent(event);
    };

    // New functions for Bootstrap Address component
    window.refreshBootstrapAddresses = async () => {
        const bootstrapAddress = document.querySelector('bootstrap-address#bootstrap-address-1');
        if (bootstrapAddress) {
            return await bootstrapAddress.postMessage({ type: 'REFRESH_ADDRESSES' });
        }
        return { success: false, error: 'Bootstrap Address component not found' };
    };

    window.getBootstrapAddressStats = async () => {
        const bootstrapAddress = document.querySelector('bootstrap-address#bootstrap-address-1');
        if (bootstrapAddress) {
            return await bootstrapAddress.postMessage({ type: 'GET_STATS' });
        }
        return { success: false, error: 'Bootstrap Address component not found' };
    };

    window.syncBootstrapWithLibp2p = async () => {
        const bootstrapAddress = document.querySelector('bootstrap-address#bootstrap-address-1');
        if (bootstrapAddress) {
            return await bootstrapAddress.postMessage({ type: 'SYNC_WITH_LIBP2P' });
        }
        return { success: false, error: 'Bootstrap Address component not found' };
    };

    window.switchBootstrapSource = async (source) => {
        const bootstrapAddress = document.querySelector('bootstrap-address#bootstrap-address-1');
        if (bootstrapAddress) {
            bootstrapAddress.setAttribute('data-source', source);
            return { success: true, source };
        }
        return { success: false, error: 'Bootstrap Address component not found' };
    };
</script>
</body>
</html>